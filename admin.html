<!DOCTYPE html><html lang="de"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Blitzer.EE â€“ Admin</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"><style>:root{--bg:#0f1222;--bg2:#131735;--surface:#1b2042;--surface2:#20265a;--text:#eef1ff;--muted:#a9b1d6;--accent:#6c5ce7;--accent2:#00d1b2;--danger:#ff5252;--fixed:#1e88e5;--marker-size:200px;--marker-border:7px;--reticle-size:96px;--reticle-border:6px;--pin:26px}*{box-sizing:border-box}html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:linear-gradient(135deg,var(--bg),var(--bg2));color:var(--text)}header{position:fixed;top:0;left:0;right:0;height:72px;background:linear-gradient(135deg,rgba(108,92,231,.9),rgba(0,209,178,.9));backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:space-between;padding:0 22px;z-index:60;box-shadow:0 4px 16px rgba(0,0,0,.25)}header .title{font-weight:700;letter-spacing:.2px;font-size:22px}header .legend{display:flex;gap:14px;align-items:center;flex-wrap:wrap}.chip{display:inline-flex;gap:10px;align-items:center;background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.18);color:#fff;padding:8px 12px;border-radius:999px;font-size:15px}.chip img{width:28px;height:28px;display:block}.login{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:80;background:rgba(0,0,0,.45);backdrop-filter:blur(4px)}.login .card{background:linear-gradient(160deg,var(--surface),var(--surface2));border:1px solid rgba(255,255,255,.08);padding:18px;border-radius:14px;box-shadow:0 16px 36px rgba(0,0,0,.45);width:90%;max-width:420px}.login h2{margin:0 0 10px 0}.login input,.login button{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:var(--surface);color:var(--text)}.login button{margin-top:10px;background:var(--accent);border:none;cursor:pointer}main{position:absolute;top:72px;left:0;right:0;bottom:0;display:grid;grid-template-columns:1.2fr 1fr;grid-auto-rows:min-content;gap:16px;padding:16px}#viewport{position:relative;width:100%;height:100%;min-height:420px;overflow:hidden;border-radius:14px}#stage{position:absolute;top:0;left:0;transform-origin:0 0;will-change:transform;transition:transform .06s linear}#map{position:absolute;top:0;left:0;display:block;user-select:none;pointer-events:none;filter:drop-shadow(0 8px 24px rgba(0,0,0,.35))}#overlay{position:absolute;top:0;left:0;pointer-events:none}.marker{position:absolute;width:var(--marker-size);height:var(--marker-size);border-radius:50%;background:var(--danger);border:var(--marker-border) solid #fff;box-shadow:0 18px 40px rgba(0,0,0,.5);transform:translate(-50%,-100%);animation:pop .2s ease-out;display:flex;align-items:center;justify-content:center} .marker::after{content:"";position:absolute;bottom:calc(-1 * var(--pin));left:50%;width:0;height:0;border-left:var(--pin) solid transparent;border-right:var(--pin) solid transparent;border-top:var(--pin) solid var(--danger);transform:translateX(-50%);} .marker.fixed{background:var(--fixed)} .marker.fixed::after{border-top-color:var(--fixed)} .marker .iconImg{width:75%;height:75%;object-fit:contain;filter:drop-shadow(0 3px 3px rgba(0,0,0,.35))}@keyframes pop{from{transform:translate(-50%,-100%) scale(.6);opacity:.6}to{transform:translate(-50%,-100%) scale(1);opacity:1}}.toolbar{position:absolute;left:16px;bottom:16px;display:flex;gap:12px;z-index:40}.btn{background:var(--surface);color:var(--text);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px 14px;font-size:16px;cursor:pointer;box-shadow:0 12px 28px rgba(0,0,0,.35)}.btn:active{transform:translateY(1px)}.fab{position:absolute;right:16px;bottom:16px;background:var(--accent2);color:#001018;border:none;border-radius:999px;padding:16px 22px;font-weight:700;font-size:16px;box-shadow:0 18px 40px rgba(0,209,178,.35);cursor:pointer;z-index:40;display:flex;gap:10px;align-items:center}.panel{background:linear-gradient(160deg,var(--surface),var(--surface2));border:1px solid rgba(255,255,255,.08);border-radius:14px;box-shadow:0 16px 36px rgba(0,0,0,.45);padding:12px;overflow:auto}.panel h3{margin-top:0}.status{font-size:14px;color:var(--muted)}table{border-collapse:collapse;width:100%;font-size:12px}th,td{border:1px solid rgba(255,255,255,.12);padding:6px}th{background:rgba(255,255,255,.06);text-align:left}.repMapWrap{position:relative;width:100%;height:360px;background:#0b0e1f;border-radius:12px;overflow:hidden;display:flex;align-items:center;justify-content:center;margin-top:12px}#repMap{max-width:100%;max-height:100%;display:block;user-select:none;pointer-events:none;filter:drop-shadow(0 8px 24px rgba(0,0,0,.35))}#repOverlay{position:absolute;pointer-events:auto}.reportDot{position:absolute;width:14px;height:14px;border-radius:50%;border:2px solid #fff;box-shadow:0 2px 6px rgba(0,0,0,.35);transform:translate(-50%,-50%);cursor:pointer}.trapPin{position:absolute;width:36px;height:36px;border-radius:50%;border:3px solid #fff;box-shadow:0 6px 14px rgba(0,0,0,.35);transform:translate(-50%,-100%);} .trapPin::after{content:"";position:absolute;bottom:-8px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid currentColor}.trapPin img{width:70%;height:70%;object-fit:contain;filter:drop-shadow(0 2px 2px rgba(0,0,0,.35))}.delBtn{background:#e53935;border:none;color:#fff;padding:6px 10px;border-radius:8px;cursor:pointer;box-shadow:0 6px 16px rgba(0,0,0,.25)}.swatch{display:inline-block;width:12px;height:12px;border-radius:50%;border:1px solid rgba(255,255,255,.9);box-shadow:0 0 0 2px rgba(0,0,0,.25) inset}.ctx{position:absolute;background:linear-gradient(160deg,var(--surface),var(--surface2));border:1px solid rgba(255,255,255,.12);border-radius:10px;box-shadow:0 12px 28px rgba(0,0,0,.45);padding:8px;display:flex;gap:8px;align-items:center;z-index:5}.ctx .id{font-size:11px;color:var(--muted)}.ctx .btn{padding:6px 10px}.fixedHeader{display:flex;align-items:center;gap:8px;margin-top:8px;margin-bottom:6px}.userPanel input{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:var(--surface);color:var(--text);width:100%;max-width:360px}</style></head><body><header><div class="title">Blitzer.EE â€“ Admin</div><div class="legend"><span class="chip"><img src="assets/mobile.svg" alt="mobil"> mobil</span><span class="chip"><img src="assets/fixed.svg" alt="fest"> fest</span></div></header><div class="login" id="login"><div class="card"><h2>Admin Login</h2><p class="status" id="loginMsg">Bitte Admin-Code eingeben.</p><input id="code" type="password" placeholder="Admin Code"><button id="loginBtn">Anmelden</button></div></div><main id="app" style="display:none"><section class="panel" style="grid-column:1/2"><h3>Karte & feste Blitzer</h3><div id="viewport"><div id="stage"><img id="map" alt="Game Map" src=""/><div id="overlay"></div></div><div class="toolbar"><button class="btn" id="zoomIn">+</button><button class="btn" id="zoomOut">-</button><button class="btn" id="reset">Reset</button></div><button class="fab" id="setFixed" title="Festes Blitzer an Auswahl setzen">ðŸ—¼ Fest setzen</button></div><div class="status" id="status">Lade ...</div><div class="fixedHeader"><h4 style="margin:0">Feste Blitzer Liste</h4><button class="btn" id="refreshFixed">Aktualisieren</button></div><table><thead><tr><th>ID</th><th>x</th><th>y</th><th>Typ</th><th>Aktion</th></tr></thead><tbody id="fixedRows"></tbody></table><h4>Map hochladen</h4><input id="mapfile" type="file" accept="image/*"><button class="btn" id="uploadMap">Als Standard-Map setzen</button></section><section class="panel" style="grid-column:2/3"><h3>Reports</h3><div style="display:flex;gap:8px;align-items:center;margin-bottom:8px"><button class="btn" id="prev">ZurÃ¼ck</button><button class="btn" id="next">Weiter</button><span class="status" id="pageInfo"></span></div><table><thead><tr><th>Farbe</th><th>Zeit</th><th>User</th><th>x</th><th>y</th><th>Bucket</th><th>Trap</th><th>Aktion</th></tr></thead><tbody id="rows"></tbody></table><h4 style="margin-top:14px">Reports-Karte (aktuelle Seite)</h4><div class="repMapWrap" id="repMapWrap"><img id="repMap" alt="Reports Map" src=""/><div id="repOverlay"></div></div></section><section class="panel" style="grid-column:2/3"><h3>User sperren</h3><p class="status">Hier kannst du einzelne User sperren/entsperren. Gesperrte Nutzer kÃ¶nnen keine Meldungen oder Fotos anlegen.</p><div class="userPanel" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap"><input id="uid" placeholder="User ID"><button class="btn" id="block">User sperren</button><button class="btn" id="unblock">User entsperren</button></div></section></main><script src="https://unpkg.com/parse/dist/parse.min.js"></script><script>Parse.initialize('coZkd3G257jEWhq710avpthkDyXBVlsqfYGdhW5t','4HdJCmF76mFSwCyrWVluMRnO4YtFOrCnZupWcFha');Parse.serverURL='https://parseapi.back4app.com';(async()=>{if(!Parse.User.current()){await Parse.AnonymousUtils.logIn();}})();const login=document.getElementById('login');const loginMsg=document.getElementById('loginMsg');const codeEl=document.getElementById('code');const loginBtn=document.getElementById('loginBtn');const app=document.getElementById('app');const viewport=document.getElementById('viewport');const stage=document.getElementById('stage');const img=document.getElementById('map');const overlay=document.getElementById('overlay');const statusEl=document.getElementById('status');const zoomInBtn=document.getElementById('zoomIn');const zoomOutBtn=document.getElementById('zoomOut');const resetBtn=document.getElementById('reset');const setFixedBtn=document.getElementById('setFixed');const fixedRows=document.getElementById('fixedRows');const refreshFixedBtn=document.getElementById('refreshFixed');const mapfile=document.getElementById('mapfile');const uploadMapBtn=document.getElementById('uploadMap');const rows=document.getElementById('rows');const pageInfo=document.getElementById('pageInfo');const repMapWrap=document.getElementById('repMapWrap');const repMap=document.getElementById('repMap');const repOverlay=document.getElementById('repOverlay');const uid=document.getElementById('uid');const blockBtn=document.getElementById('block');const unblockBtn=document.getElementById('unblock');let adminCode=null;let mapLoaded=false;let scale=1, tx=0, ty=0, fitScale=1;let selection=null;let skip=0;const limit=50;const LS_KEY='blitzer_admin_code';const LS_TS='blitzer_admin_ts';const TTL=3*24*60*60*1000;let activeMapUrl='';let lastReports=[];let lastReportTraps=[];let fixedTraps=[];function colorFor(id, idx){const s=(id||'')+':'+idx;let h=0;for(let i=0;i<s.length;i++){h=(h*31+s.charCodeAt(i))>>>0;}const hue=h%360;return `hsl(${hue} 85% 55%)`;}async function tryAutoLogin(){const saved=localStorage.getItem(LS_KEY);const ts=parseInt(localStorage.getItem(LS_TS)||'0',10);if(!saved||!ts) return false;if(Date.now()-ts>TTL){localStorage.removeItem(LS_KEY);localStorage.removeItem(LS_TS);return false;}try{await Parse.Cloud.run('adminListReports',{adminCode:saved,limit:1,skip:0});adminCode=saved;login.style.display='none';app.style.display='grid';await loadActiveMap();await refreshAll();return true;}catch(e){localStorage.removeItem(LS_KEY);localStorage.removeItem(LS_TS);return false;}}loginBtn.addEventListener('click',async()=>{try{await Parse.Cloud.run('adminListReports',{adminCode:codeEl.value,limit:1,skip:0});adminCode=String(codeEl.value).trim();localStorage.setItem(LS_KEY,adminCode);localStorage.setItem(LS_TS,String(Date.now()));login.style.display='none';app.style.display='grid';await loadActiveMap();await refreshAll();}catch(e){loginMsg.textContent='Fehler: '+(e.message||e);}});tryAutoLogin();function setStatus(t){statusEl.textContent=t||'';}async function loadActiveMap(){const res=await Parse.Cloud.run('getActiveMap');if(res.url){activeMapUrl=res.url;img.src=res.url;img.onload=()=>{setupStage();refreshMarkers();setStatus('Map geladen');};repMap.src=res.url;repMap.onload=()=>{syncRepOverlay();drawReportsDots(lastReports,lastReportTraps);};}}function setupStage(){mapLoaded=true;const nw=img.naturalWidth, nh=img.naturalHeight;img.style.width=nw+'px';img.style.height=nh+'px';overlay.style.width=nw+'px';overlay.style.height=nh+'px';overlay.innerHTML='';fitToView();bindInteractions();setTimeout(()=>{zoomAt(viewport.clientWidth/2,viewport.clientHeight/2,3.2);},60);}function fitToView(){const vw=viewport.clientWidth, vh=viewport.clientHeight;const nw=img.naturalWidth, nh=img.naturalHeight;fitScale=Math.min(vw/nw,vh/nh);scale=fitScale;tx=(vw-nw*scale)/2;ty=(vh-nh*scale)/2;applyTransform();}function applyTransform(){stage.style.transform=`translate(${tx}px,${ty}px) scale(${scale})`;}function screenToWorld(clientX,clientY){const rect=viewport.getBoundingClientRect();const sx=clientX-rect.left-tx;const sy=clientY-rect.top-ty;return {x:Math.round(sx/scale), y:Math.round(sy/scale)};}function worldToScreen(wx,wy){const rect=viewport.getBoundingClientRect();return {x:rect.left+tx+wx*scale, y:rect.top+ty+wy*scale};}function zoomAt(clientX,clientY,factor){const before=screenToWorld(clientX,clientY);const newScale=Math.max(fitScale*0.25,Math.min(fitScale*10,scale*factor));scale=newScale;const after=worldToScreen(before.x,before.y);tx+=clientX-after.x;ty+=clientY-after.y;applyTransform();}function bindInteractions(){viewport.addEventListener('wheel',(e)=>{e.preventDefault();const f=e.deltaY>0?0.9:1.1;zoomAt(e.clientX,e.clientY,f);},{passive:false});let dragging=false,lastX=0,lastY=0;viewport.addEventListener('mousedown',(e)=>{dragging=true;lastX=e.clientX;lastY=e.clientY;});window.addEventListener('mouseup',()=>dragging=false);window.addEventListener('mousemove',(e)=>{if(!dragging)return;tx+=e.clientX-lastX;ty+=e.clientY-lastY;lastX=e.clientX;lastY=e.clientY;applyTransform();});viewport.addEventListener('click',(e)=>{if(!mapLoaded)return;const w=screenToWorld(e.clientX,e.clientY);if(w.x<0||w.y<0||w.x>img.naturalWidth||w.y>img.naturalHeight)return;selection=w;showReticle(w.x,w.y);setStatus(`Auswahl: x ${w.x} â€¢ y ${w.y}`);});window.addEventListener('resize',()=>{fitToView();syncRepOverlay();drawReportsDots(lastReports,lastReportTraps);});zoomInBtn.onclick=()=>zoomAt(viewport.clientWidth/2,viewport.clientHeight/2,1.2);zoomOutBtn.onclick=()=>zoomAt(viewport.clientWidth/2,viewport.clientHeight/2,0.8333);resetBtn.onclick=fitToView;}function showReticle(x,y){let r=document.querySelector('.reticle');if(!r){r=document.createElement('div');r.className='reticle';overlay.appendChild(r);}r.style.left=x+'px';r.style.top=y+'px';}async function refreshMarkers(){if(!mapLoaded)return;const traps=await Parse.Cloud.run('getSpeedTrapsPx',{minX:0,minY:0,maxX:999999,maxY:999999});renderMarkers(traps);await loadFixedTraps();}function renderMarkers(traps){overlay.querySelectorAll('.marker').forEach(m=>m.remove());traps.forEach(t=>{const el=document.createElement('div');el.className='marker'+(t.type==='fixed'?' fixed':'');el.style.left=t.x+'px';el.style.top=t.y+'px';const icon=document.createElement('img');icon.className='iconImg';icon.alt=t.type==='fixed'?'fest':'mobil';icon.src=t.type==='fixed'?'assets/fixed.svg':'assets/mobile.svg';el.appendChild(icon);overlay.appendChild(el);});}async function loadFixedTraps(){const traps=await Parse.Cloud.run('getSpeedTrapsPx',{minX:0,minY:0,maxX:999999,maxY:999999});fixedTraps=traps.filter(t=>t.type==='fixed');renderFixedList(fixedTraps);}function renderFixedList(list){fixedRows.innerHTML='';list.forEach(t=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${t.id}</td><td>${t.x}</td><td>${t.y}</td><td>${t.type}</td><td><button class='btn' data-id='${t.id}'>Entfernen</button></td>`;const btn=tr.querySelector('button');btn.addEventListener('click',async()=>{try{await Parse.Cloud.run('adminUpsertFixedTrapByCode',{adminCode,trapId:t.id,remove:true});await refreshAll();}catch(e){alert(e.message||e);}});fixedRows.appendChild(tr);});}refreshFixedBtn.addEventListener('click',()=>loadFixedTraps());function toBase64(file){return new Promise((resolve,reject)=>{const r=new FileReader();r.onload=()=>resolve(r.result.split(',')[1]);r.onerror=reject;r.readAsDataURL(file);});}setFixedBtn.addEventListener('click',async()=>{try{if(!selection){alert('Bitte zuerst auf die Map klicken.');return;}await Parse.Cloud.run('adminUpsertFixedTrapByCode',{adminCode,x:selection.x,y:selection.y});setStatus('Festes Blitzer gesetzt');await refreshAll();}catch(e){setStatus('Fehler: '+(e.message||e));}});uploadMapBtn.addEventListener('click',async()=>{try{if(!mapfile.files||!mapfile.files[0])return;setStatus('Lade Map...');const b64=await toBase64(mapfile.files[0]);const res=await Parse.Cloud.run('adminSetActiveMap',{adminCode,fileName:mapfile.files[0].name,fileBase64:b64});img.src=res.url;repMap.src=res.url;setStatus('Map aktualisiert');await refreshAll();}catch(e){setStatus('Fehler: '+(e.message||e));}});blockBtn.addEventListener('click',async()=>{try{const id=uid.value.trim();if(!id){alert('User ID eingeben');return;}const res=await Parse.Cloud.run('adminSetUserBlocked',{adminCode,userId:id,blocked:true});alert('User gesperrt: '+res.userId);}catch(e){alert(e.message||e);}});unblockBtn.addEventListener('click',async()=>{try{const id=uid.value.trim();if(!id){alert('User ID eingeben');return;}const res=await Parse.Cloud.run('adminSetUserBlocked',{adminCode,userId:id,blocked:false});alert('User entsperrt: '+res.userId);}catch(e){alert(e.message||e);}});async function refreshAll(){await refreshMarkers();await loadReports();}async function loadReports(){try{const data=await Parse.Cloud.run('adminListReports',{adminCode,limit,skip});lastReports=data;rows.innerHTML='';data.forEach((r,idx)=>{const color=colorFor(r.id,idx);const tr=document.createElement('tr');tr.innerHTML=`<td><span class='swatch' style='background:${color}' title='${r.id}'></span></td><td>${new Date(r.createdAt).toLocaleString()}</td><td>${r.userId||''}</td><td>${r.x??''}</td><td>${r.y??''}</td><td>${r.bucketKey||''}</td><td>${r.speedTrapId||''}</td><td><button class='delBtn' data-id='${r.id}'>LÃ¶schen</button></td>`;rows.appendChild(tr);});rows.querySelectorAll('.delBtn').forEach(btn=>{btn.addEventListener('click',async(e)=>{const id=e.currentTarget.getAttribute('data-id');if(!confirm('Diesen Report wirklich lÃ¶schen?')) return;try{await Parse.Cloud.run('adminDeleteReport',{adminCode,reportId:id});await refreshAll();}catch(err){alert(err.message||err);}});});pageInfo.textContent=`${skip+1} - ${skip+data.length}`;ensureRepMap();await loadTrapsForReports(lastReports);drawReportsDots(lastReports,lastReportTraps);}catch(e){console.error(e);}}document.getElementById('prev').onclick=()=>{skip=Math.max(0,skip-limit);loadReports();};document.getElementById('next').onclick=()=>{skip+=limit;loadReports();};function ensureRepMap(){if(!activeMapUrl) return; if(repMap.src!==activeMapUrl){repMap.src=activeMapUrl;}}function syncRepOverlay(){const wrapRect=repMapWrap.getBoundingClientRect();const imgRect=repMap.getBoundingClientRect();repOverlay.style.left=(imgRect.left-wrapRect.left)+'px';repOverlay.style.top=(imgRect.top-wrapRect.top)+'px';repOverlay.style.width=imgRect.width+'px';repOverlay.style.height=imgRect.height+'px';repOverlay.style.position='absolute';}async function loadTrapsForReports(list){const ids=[...new Set(list.map(r=>r.speedTrapId).filter(Boolean))];if(!ids.length){lastReportTraps=[];return;}const SpeedTrap=Parse.Object.extend('SpeedTrap');const q=new Parse.Query(SpeedTrap);q.containedIn('objectId',ids);const results=await q.find({useMasterKey:true});lastReportTraps=results.map(t=>({id:t.id,x:t.get('x'),y:t.get('y'),type:t.get('type')}));}function drawReportsDots(list,traps){if(!repMap.complete) return;syncRepOverlay();repOverlay.innerHTML='';const cw=repOverlay.clientWidth;const ch=repOverlay.clientHeight;const nw=repMap.naturalWidth||1;const nh=repMap.naturalHeight||1;list.forEach((r,idx)=>{if(typeof r.x==='number'&&typeof r.y==='number'){const dx=(r.x/nw)*cw;const dy=(r.y/nh)*ch;const d=document.createElement('div');d.className='reportDot';d.style.left=dx+'px';d.style.top=dy+'px';const color=colorFor(r.id,idx);d.style.background=color;d.dataset.id=r.id;d.title=r.id;d.addEventListener('click',(ev)=>{ev.stopPropagation();showCtx(dx,dy,r.id,color);});repOverlay.appendChild(d);}});traps&&traps.forEach(t=>{if(typeof t.x==='number'&&typeof t.y==='number'){const dx=(t.x/nw)*cw;const dy=(t.y/nh)*ch;const pin=document.createElement('div');pin.className='trapPin';pin.style.left=dx+'px';pin.style.top=dy+'px';pin.style.color=(t.type==='fixed')?'#1e88e5':'#ff5252';const icon=document.createElement('img');icon.src=(t.type==='fixed')?'assets/fixed.svg':'assets/mobile.svg';pin.appendChild(icon);pin.title=`Trap ${t.id}`;repOverlay.appendChild(pin);}});}function showCtx(px,py,id,color){let ctx=document.querySelector('.ctx');if(!ctx){ctx=document.createElement('div');ctx.className='ctx';repOverlay.appendChild(ctx);}ctx.innerHTML=`<span class='swatch' style='background:${color}'></span><span class='id'>${id}</span><button class='btn delBtn'>LÃ¶schen</button>`;ctx.style.left=(px+10)+'px';ctx.style.top=(py+10)+'px';const del=ctx.querySelector('.delBtn');del.onclick=async()=>{if(!confirm('Diesen Report wirklich lÃ¶schen?')) return;try{await Parse.Cloud.run('adminDeleteReport',{adminCode,reportId:id});ctx.remove();await refreshAll();}catch(e){alert(e.message||e);} };document.addEventListener('click',onDocClick);function onDocClick(e){if(!ctx.contains(e.target)){ctx.remove();document.removeEventListener('click',onDocClick);} }}</script></body></html>