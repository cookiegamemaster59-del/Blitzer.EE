<!DOCTYPE html><html lang="de"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Blitzer.EE ‚Äì Map</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"><style>:root{--bg:#0f1222;--bg2:#131735;--surface:#1b2042;--surface2:#20265a;--text:#eef1ff;--muted:#a9b1d6;--accent:#6c5ce7;--accent2:#00d1b2;--danger:#ff5252;--fixed:#1e88e5;--marker-size:200px;--marker-border:7px;--reticle-size:96px;--reticle-border:6px;--pin:26px}*{box-sizing:border-box}html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:linear-gradient(135deg,var(--bg),var(--bg2));color:var(--text)}header{position:fixed;top:0;left:0;right:0;height:72px;background:linear-gradient(135deg,rgba(108,92,231,.9),rgba(0,209,178,.9));backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:space-between;padding:0 22px;z-index:50;box-shadow:0 4px 16px rgba(0,0,0,.25)}header .title{font-weight:700;letter-spacing:.2px;font-size:22px}header .legend{display:flex;gap:14px;align-items:center;flex-wrap:wrap}.chip{display:inline-flex;gap:10px;align-items:center;background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.18);color:#fff;padding:8px 12px;border-radius:999px;font-size:15px}.chip img{width:28px;height:28px;display:block}.chip.toggle{cursor:pointer;border-color:rgba(255,255,255,.35)}</style><style>main{position:absolute;top:72px;left:0;right:0;bottom:0}#viewport{position:relative;width:100%;height:100%;overflow:hidden}#stage{position:absolute;top:0;left:0;transform-origin:0 0;will-change:transform;transition:transform .06s linear}#map{position:absolute;top:0;left:0;display:block;user-select:none;pointer-events:none;filter:drop-shadow(0 8px 24px rgba(0,0,0,.35))}#overlay{position:absolute;top:0;left:0;pointer-events:none}.marker{position:absolute;width:var(--marker-size);height:var(--marker-size);border-radius:50%;background:var(--danger);border:var(--marker-border) solid #fff;box-shadow:0 18px 40px rgba(0,0,0,.5);transform:translate(-50%,-100%);animation:pop .2s ease-out;display:flex;align-items:center;justify-content:center} .marker::after{content:"";position:absolute;bottom:calc(-1 * var(--pin));left:50%;width:0;height:0;border-left:var(--pin) solid transparent;border-right:var(--pin) solid transparent;border-top:var(--pin) solid var(--danger);transform:translateX(-50%);} .marker.fixed{background:var(--fixed)} .marker.fixed::after{border-top-color:var(--fixed)} .marker .iconImg{width:75%;height:75%;object-fit:contain;filter:drop-shadow(0 3px 3px rgba(0,0,0,.35))}@keyframes pop{from{transform:translate(-50%,-100%) scale(.6);opacity:.6}to{transform:translate(-50%,-100%) scale(1);opacity:1}}.fab{position:fixed;right:24px;bottom:84px;background:var(--accent);color:#fff;border:none;border-radius:999px;padding:20px 26px;font-weight:700;font-size:18px;box-shadow:0 18px 40px rgba(108,92,231,.45);cursor:pointer;z-index:40;display:flex;gap:12px;align-items:center;transition:transform .08s ease,box-shadow .08s ease}.fab:disabled{opacity:.5;cursor:not-allowed}.fab:active{transform:translateY(1px);box-shadow:0 14px 28px rgba(108,92,231,.4)}.toolbar{position:fixed;left:24px;bottom:24px;display:flex;gap:12px;z-index:40}.btn{background:var(--surface);color:var(--text);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:14px 16px;font-size:18px;cursor:pointer;box-shadow:0 12px 28px rgba(0,0,0,.35)}.btn:active{transform:translateY(1px)}.card{position:fixed;top:88px;left:24px;background:linear-gradient(160deg,var(--surface),var(--surface2));border:1px solid rgba(255,255,255,.08);padding:14px 16px;border-radius:14px;box-shadow:0 16px 36px rgba(0,0,0,.45);z-index:30;display:flex;gap:12px;align-items:center}.status{font-size:16px;color:var(--muted)}.reticle{position:absolute;width:var(--reticle-size);height:var(--reticle-size);border:var(--reticle-border) solid var(--accent2);border-radius:50%;transform:translate(-50%,-50%);box-shadow:0 0 0 8px rgba(0,209,178,.25);pointer-events:none;background:radial-gradient(circle at center, rgba(0,209,178,.18) 0 40%, transparent 41%)}.ping{position:absolute;width:20px;height:20px;border-radius:50%;background:rgba(255,255,255,.9);box-shadow:0 0 0 8px rgba(255,255,255,.25);transform:translate(-50%,-50%);animation:ping 900ms ease-out forwards}@keyframes ping{0%{opacity:0.9;transform:translate(-50%,-50%) scale(0.6)}70%{opacity:0.6}100%{opacity:0;transform:translate(-50%,-50%) scale(2.6)}}.toast{position:fixed;left:50%;bottom:112px;transform:translateX(-50%);background:#111827;color:#fff;padding:14px 18px;border-radius:12px;box-shadow:0 12px 30px rgba(0,0,0,.45);opacity:0;pointer-events:none;transition:opacity .2s ease;z-index:50}.toast.show{opacity:1}.instructions{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);z-index:45;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.16);backdrop-filter:blur(6px);padding:8px 12px;border-radius:999px;display:flex;gap:8px;align-items:center}.instructions .step{font-size:14px;color:#fff;opacity:.75;padding:4px 8px;border-radius:999px;border:1px solid transparent}.instructions .step.active{background:rgba(0,209,178,.22);border-color:rgba(0,209,178,.45);opacity:1}.instructions .sep{opacity:.6}.undoBar{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);z-index:46;background:rgba(0,0,0,.7);color:#fff;padding:10px 12px;border-radius:12px;display:none;gap:10px;align-items:center}.undoBar button{background:#ef4444;color:#fff;border:none;border-radius:8px;padding:8px 10px;cursor:pointer}</style><link rel="manifest" href="/manifest.webmanifest"><meta name="theme-color" content="#0f1222"><link rel="apple-touch-icon" href="/icons/icon-192.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"></head><body><header><div class="title">Blitzer.EE</div><div class="legend"><span class="chip"><img src="https://blitzeree-zroqe7.b4a.app/assets/mobile.svg" alt="mobil"> mobil</span><span class="chip"><img src="https://blitzeree-zroqe7.b4a.app/assets/fixed.svg" alt="fest"> fest</span><span class="chip toggle" id="notifyToggle">üîî Benachrichtigungen aus</span></div></header><div class="admin-entry"><button id="adminOpen" class="btn" style="position:fixed;top:84px;right:24px;z-index:60">Admin</button></div><div id="adminModal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:80"><div style="background:#111827;border:1px solid rgba(255,255,255,.1);padding:16px;border-radius:12px;min-width:280px;color:#fff"><h3 style="margin-top:0">Admin Login</h3><input id="adminCode" type="password" placeholder="Admin Code" style="width:100%;padding:10px;border-radius:8px;border:1px solid #374151;background:#0b1020;color:#fff"><div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px"><button id="adminCancel" class="btn" style="background:#374151">Abbrechen</button><button id="adminSubmit" class="btn">Best√§tigen</button></div><div id="adminError" style="color:#f87171;margin-top:8px;display:none">Falscher Code</div></div></div><main><div id="viewport"><div id="stage"><img id="map" alt="Game Map" src="index.html"/><div id="overlay"></div></div><div class="card"><div id="status" class="status">Lade ...</div></div><div class="toolbar"><button class="btn" id="zoomIn">+</button><button class="btn" id="zoomOut">-</button><button class="btn" id="reset">Reset</button></div><button class="fab" id="report" disabled>üìç Melden</button><div id="toast" class="toast"></div><div class="instructions" id="instructions"><span class="step step1 active">1. Tippe zuerst eine Position</span><span class="sep">‚Üí</span><span class="step step2">2. Dr√ºcke "Melden"</span></div><div class="undoBar" id="undoBar"><span id="undoText">Gesendet. √Ñnderbar in 60s</span><button id="undoBtn">Report l√∂schen</button></div></div></main><script src="https://unpkg.com/parse/dist/parse.min.js"></script><script>Parse.initialize('coZkd3G257jEWhq710avpthkDyXBVlsqfYGdhW5t','4HdJCmF76mFSwCyrWVluMRnO4YtFOrCnZupWcFha');Parse.serverURL='https://parseapi.back4app.com';(async()=>{if(!Parse.User.current()){await Parse.AnonymousUtils.logIn();}})();const viewport=document.getElementById('viewport');const stage=document.getElementById('stage');const img=document.getElementById('map');const overlay=document.getElementById('overlay');const statusEl=document.getElementById('status');const zoomInBtn=document.getElementById('zoomIn');const zoomOutBtn=document.getElementById('zoomOut');const resetBtn=document.getElementById('reset');const reportBtn=document.getElementById('report');const toast=document.getElementById('toast');const instructions=document.getElementById('instructions');const undoBar=document.getElementById('undoBar');const undoText=document.getElementById('undoText');const undoBtn=document.getElementById('undoBtn');const notifyToggle=document.getElementById('notifyToggle');const LS_NOTIFY='blitzer_notify';let notifyEnabled=localStorage.getItem(LS_NOTIFY)==='1';function updateNotifyUI(){notifyToggle.textContent=notifyEnabled?'üîî Benachrichtigungen an':'üîï Benachrichtigungen aus';}notifyToggle.onclick=()=>{notifyEnabled=!notifyEnabled;localStorage.setItem(LS_NOTIFY,notifyEnabled?'1':'0');updateNotifyUI();};updateNotifyUI();let mapLoaded=false;let scale=1, tx=0, ty=0, fitScale=1;let selection=null;let cooldownTimer=null;let lastReportId=null;let lastEditUntil=0;let liveSub=null;function showToast(msg){toast.textContent=msg;toast.classList.add('show');setTimeout(()=>toast.classList.remove('show'),2000);}function setStatus(t){statusEl.textContent=t||'';}function setSteps(hasSelection){const s1=instructions.querySelector('.step1');const s2=instructions.querySelector('.step2');if(hasSelection){s1.classList.remove('active');s2.classList.add('active');}else{s1.classList.add('active');s2.classList.remove('active');}}async function loadActiveMap(){try{const res=await Parse.Cloud.run('getActiveMap');if(res.url){img.src=res.url;img.onload=()=>{setupStage();refreshMarkers();initLiveQuery();setStatus('Map geladen');initCooldownUI();};}else{setStatus('Keine Map gesetzt.');}}catch(e){setStatus('Fehler: '+e.message);}}function setupStage(){mapLoaded=true;const nw=img.naturalWidth, nh=img.naturalHeight;img.style.width=nw+'px';img.style.height=nh+'px';overlay.style.width=nw+'px';overlay.style.height=nh+'px';overlay.innerHTML='';fitToView();bindInteractions();setTimeout(()=>{zoomAt(viewport.clientWidth/2,viewport.clientHeight/2,3.2);},60);setSteps(false);}function fitToView(){const vw=viewport.clientWidth, vh=viewport.clientHeight;const nw=img.naturalWidth, nh=img.naturalHeight;fitScale=Math.min(vw/nw,vh/nh);scale=fitScale;tx=(vw-nw*scale)/2;ty=(vh-nh*scale)/2;applyTransform();}function applyTransform(){stage.style.transform=`translate(${tx}px,${ty}px) scale(${scale})`;}function screenToWorld(clientX,clientY){const rect=viewport.getBoundingClientRect();const sx=clientX-rect.left-tx;const sy=clientY-rect.top-ty;return {x:Math.round(sx/scale), y:Math.round(sy/scale)};}function worldToScreen(wx,wy){const rect=viewport.getBoundingClientRect();return {x:rect.left+tx+wx*scale, y:rect.top+ty+wy*scale};}function zoomAt(clientX,clientY,factor){const before=screenToWorld(clientX,clientY);const newScale=Math.max(fitScale*0.25,Math.min(fitScale*10,scale*factor));scale=newScale;const after=worldToScreen(before.x,before.y);tx+=clientX-after.x;ty+=clientY-after.y;applyTransform();}function bindInteractions(){viewport.addEventListener('wheel',(e)=>{e.preventDefault();const f=e.deltaY>0?0.9:1.1;zoomAt(e.clientX,e.clientY,f);},{passive:false});let dragging=false,lastX=0,lastY=0;viewport.addEventListener('mousedown',(e)=>{dragging=true;lastX=e.clientX;lastY=e.clientY;});window.addEventListener('mouseup',()=>dragging=false);window.addEventListener('mousemove',(e)=>{if(!dragging)return;tx+=e.clientX-lastX;ty+=e.clientY-lastY;lastX=e.clientX;lastY=e.clientY;applyTransform();});viewport.addEventListener('click',async(e)=>{if(!mapLoaded)return;const w=screenToWorld(e.clientX,e.clientY);if(w.x<0||w.y<0||w.x>img.naturalWidth||w.y>img.naturalHeight)return;selection=w;showReticle(w.x,w.y);reportBtn.disabled=false;setStatus(`Position: x ${w.x} ‚Ä¢ y ${w.y}`);setSteps(true);});window.addEventListener('resize',fitToView);zoomInBtn.onclick=()=>zoomAt(viewport.clientWidth/2,viewport.clientHeight/2,1.2);zoomOutBtn.onclick=()=>zoomAt(viewport.clientWidth/2,viewport.clientHeight/2,0.8333);resetBtn.onclick=fitToView;}function showReticle(x,y){let r=document.querySelector('.reticle');if(!r){r=document.createElement('div');r.className='reticle';overlay.appendChild(r);}r.style.left=x+'px';r.style.top=y+'px';}function pingAt(x,y){const p=document.createElement('div');p.className='ping';p.style.left=x+'px';p.style.top=y+'px';overlay.appendChild(p);setTimeout(()=>p.remove(),950);}async function refreshMarkers(){if(!mapLoaded)return;try{const traps=await Parse.Cloud.run('getSpeedTrapsPx',{minX:0,minY:0,maxX:999999,maxY:999999});renderMarkers(traps);}catch(e){console.error(e);}}function renderMarkers(traps){overlay.querySelectorAll('.marker').forEach(m=>m.remove());traps.forEach(t=>{const el=document.createElement('div');el.className='marker'+(t.type==='fixed'?' fixed':'');el.style.left=t.x+'px';el.style.top=t.y+'px';const icon=document.createElement('img');icon.className='iconImg';icon.alt=t.type==='fixed'?'fest':'mobil';icon.src=t.type==='fixed'?'assets/fixed.svg':'assets/mobile.svg';el.appendChild(icon);overlay.appendChild(el);});}async function initCooldownUI(){try{const res=await Parse.Cloud.run('getReportCooldown');updateCooldown(res.remainingMs);}catch(e){console.warn('Cooldown check failed',e);}}function updateCooldown(ms){if(cooldownTimer){clearInterval(cooldownTimer);cooldownTimer=null;}if(ms<=0){reportBtn.disabled=false;reportBtn.textContent='üìç Melden';return;}reportBtn.disabled=true;const end=Date.now()+ms;cooldownTimer=setInterval(()=>{const left=Math.max(0,end-Date.now());const mm=Math.floor(left/60000);const ss=Math.floor((left%60000)/1000).toString().padStart(2,'0');reportBtn.textContent=`‚è≥ ${mm}:${ss}`;if(left<=0){clearInterval(cooldownTimer);cooldownTimer=null;reportBtn.disabled=false;reportBtn.textContent='üìç Melden';}},1000);}let undoTimer=null;function startUndoTimer(editMs){clearInterval(undoTimer);const until=Date.now()+editMs;lastEditUntil=until;undoBar.style.display='flex';undoBtn.disabled=false;undoTimer=setInterval(()=>{const left=Math.max(0, until-Date.now());const s=Math.ceil(left/1000);undoText.textContent=`Gesendet. √Ñnderbar in ${s}s`;if(left<=0){clearInterval(undoTimer);undoBar.style.display='none';}},250);}undoBtn.onclick=async()=>{try{if(!lastReportId) return; const res=await Parse.Cloud.run('userDeleteReport',{reportId:lastReportId});showToast('Report gel√∂scht');undoBar.style.display='none';await refreshMarkers();}catch(e){showToast('Nicht mehr m√∂glich: '+(e.message||e));}};reportBtn.onclick=async()=>{try{if(!selection){showToast('Bitte zuerst auf die Karte tippen und den Punkt w√§hlen');const centerW=screenToWorld(viewport.clientWidth/2,viewport.clientHeight/2);pingAt(Math.max(0,Math.min(centerW.x,img.naturalWidth)),Math.max(0,Math.min(centerW.y,img.naturalHeight)));return;}pingAt(selection.x,selection.y);const res=await Parse.Cloud.run('reportSpeedTrapPx_v3',{x:selection.x,y:selection.y,type:'game'});if(res&&res.cooldown){updateCooldown(res.remainingMs);showToast('Cooldown aktiv');return;}if(res&&res.reportId){lastReportId=res.reportId;startUndoTimer(res.editWindowMs||60000);}showToast('Gemeldet!');await initCooldownUI();await refreshMarkers();}catch(err){showToast('Fehler: '+(err.message||err));}};function initLiveQuery(){try{const q=new Parse.Query('SpeedTrap');q.equalTo('status','active');q.descending('createdAt');q.limit(1);q.subscribe().then(sub=>{liveSub=sub;sub.on('create',(obj)=>{onNewTrap(obj);});});}catch(e){console.warn('LiveQuery init failed',e);} }function onNewTrap(trap){showToast('Neuer Blitzer hinzugef√ºgt');if(!notifyEnabled) return;try{if('speechSynthesis' in window){const u=new SpeechSynthesisUtterance('Neuer Blitzer hinzugef√ºgt');u.lang='de-DE';window.speechSynthesis.speak(u);}else if(window.AudioContext||window.webkitAudioContext){const AC=window.AudioContext||window.webkitAudioContext;const ac=new AC();const o=ac.createOscillator();const g=ac.createGain();o.type='sine';o.frequency.value=880;g.gain.value=0.001;o.connect(g);g.connect(ac.destination);o.start();g.gain.exponentialRampToValueAtTime(0.3,ac.currentTime+0.01);g.gain.exponentialRampToValueAtTime(0.0001,ac.currentTime+0.3);o.stop(ac.currentTime+0.32);} }catch(e){console.warn('notify error',e);} }loadActiveMap();setInterval(refreshMarkers,30000);</script><script>if("serviceWorker" in navigator){navigator.serviceWorker.register("/service-worker.js").catch(()=>{});} (function(){const m=document.getElementById("adminModal");const openBtn=document.getElementById("adminOpen");const cancel=document.getElementById("adminCancel");const submit=document.getElementById("adminSubmit");const codeEl=document.getElementById("adminCode");const err=document.getElementById("adminError");function open(){m.style.display="flex";err.style.display="none";codeEl.value="";setTimeout(()=>codeEl.focus(),0);}function close(){m.style.display="none";}openBtn</body></body>openBtn.addEventListener("click",open);cancel</body></body>cancel.addEventListener("click",close);submit</body></body>submit.addEventListener("click",async()=>{const code=(codeEl.value||"").trim();if(!code)return;try{const res=await Parse.Cloud.run("adminLogin",{code});if(res</body></body>res.ok){localStorage.setItem("admin_ok","1");close();const t=document.getElementById("toast");if(t){t.textContent="Admin freigeschaltet";t.classList.add("show");setTimeout(()=>t.classList.remove("show"),1500);}}else{throw new Error("invalid");}}catch(e){err.style.display="block";}});})();</script></body></html>
<div class="admin-entry"><button id="adminOpen" class="btn" style="position:fixed;top:84px;right:24px;z-index:60">Admin</button></div>
<div id="adminModal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:80"><div style="background:#111827;border:1px solid rgba(255,255,255,.1);padding:16px;border-radius:12px;min-width:280px;color:#fff"><h3 style="margin-top:0">Admin Login</h3><input id="adminCode" type="password" placeholder="Admin Code" style="width:100%;padding:10px;border-radius:8px;border:1px solid #374151;background:#0b1020;color:#fff"><div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px"><button id="adminCancel" class="btn" style="background:#374151">Abbrechen</button><button id="adminSubmit" class="btn">Best√§tigen</button></div><div id="adminError" style="color:#f87171;margin-top:8px;display:none">Falscher Code</div></div></div>

